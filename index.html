<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Test Telegram WebApps API</title>
   <script src="https://telegram.org/js/telegram-web-app.js"></script> <!--Подключаем скрипт от телеграм-->
   <style>
      body{
         color: var(--tg-theme-text-color);
         background: var(--tg-theme-bg-color);
         display: flex;
         flex-direction: column;
         align-items: center;
         font-size: 18px;
      }

      .hint{
         color: var(--tg-theme-hint-color);
      }

      .link{
         color: var(--tg-theme-link-color);
      }

      .button{
         background: var(--tg-theme-button-color);
         color: var(--tg-theme-button-text-color);
         border: none;
         font-size: 18px;
      }

      .button:not(:last-child){
         margin-bottom: 20px
      }

      #usercard{
         text-align: center;
      }
   </style>
</head>

<body>
   <!--<button id="btn" class="button">Show/Hide Main Button</button> <!--Кнопка, чтобы скрыть / показать основную кнопку-->
   <!--<button id="btnED" class="button">Enable/Disable Main Button</button> <!--Кнопка, чтобы сделать кнопку активной/неактивной-->
   <!--Выводим наш гет в base64-->
   <div id="div-get">
   </div>
   <!--Выводим декодированный гет-->
   <form>
      <div id="div-form">
      </div>
   </form>
   <!--Выводим имя бренда-->
   <form>
      <label for = "div-brand_name">Ваш бренд:</label>
      <span id="div-brand_name">
      </span>
   </form>
   <!--Выводим тип отчёта-->
   <form>
      <label for = "div-order_type_1">Ваш тип отчёта:</label>
      <span id="div-order_type_1">
      </span>
   </form>
   <!--Выводим поля из отчёта тип = 1-->
   <!--http://shurick31.narod.ru/dynamic_forms.html-->
   <form name="links" method="post">
      <table id="tbl1">
      </table>
   </form>
</body>

<script>
   //функция декодирования base64 в str с ru
   function b64_to_utf8(str) {
      return decodeURIComponent(escape(window.atob(str)));
   }

   url=new URL(document.location.href) //Получаем URL
   //document.getElementById('div-get').innerHTML=url.searchParams.get('data'); // Выводим параметр data в лейбл
   data_base64=url.searchParams.get('data');// Выводим параметр data в переменную
   data_base64=data_base64.replace(/-/g, "+");// Заменяем все - на + (т.к. браузер сам интерпритирует +)
   data=b64_to_utf8(data_base64) // Декодируем
   //document.getElementById('div-form').innerHTML=data; //Выводим в лейбл
   data=JSON.parse(data); // Парсим str в JSON
   console.log(data); // Выводим в консоль браузера

   document.getElementById('div-brand_name').innerHTML=data[0].split(';')[1].split(':')[1]; //Выводим название бренда
   document.getElementById('div-order_type_1').innerHTML=data[1][0].split(';')[1].split(':')[1]; //выводим название отчёта type 1

   //Функция для формирования формы для сотрудника
   function _build_form1(data) {
      var code ='';
      for (key in data[1][1]) {
         //console.log("Ключ = " + key);
         //console.log("Значение = " + data[1][1][key]);
         var a= data[1][1][key].split(';');
         code = code+' <TR><TD><B>'+a[1].split(':')[1]+':<B></TD><TD><INPUT NAME="'+a[0].split(':')[1]+'" ID="'+a[1].split(':')[1]+'" SIZE=20 onBlur="this.value=this.value.toUpperCase()"></TD></TR>'
      }
      document.getElementById('tbl1').innerHTML=code
   }
   _build_form1(data)// Формируем форму

    //Функция проверки значений в полях
    function myFunction() {
      //alert("Hello");
      console.log(Number.isInteger());
    }

   var commonSUM = document.getElementById('Общая сумма');
   var commonCHECK = document.getElementById('Общее кол-во чеков');
   //console.log(commonSUM);
   //console.log(commonCHECK);
   commonSUM.addEventListener('blur', myFunction());
   commonCHECK.addEventListener('blur', myFunction());


   //Функция проверки значений в полях

   //запуск функции повесить на событие



   let tg = window.Telegram.WebApp; //получаем объект webapp телеграма
   if ('первые два отчёта заполнены'){
         tg.MainButton.show() //показываем кнопку
      }
      else{ //иначе
         tg.MainButton.hide() //скрываем
      }
   tg.expand(); //расширяем на все окно
   tg.MainButton.text = "Changed Text"; //изменяем текст кнопки
   tg.MainButton.setText("Changed Text1"); //изменяем текст кнопки иначе
   tg.MainButton.textColor = "#F55353"; //изменяем цвет текста кнопки
   tg.MainButton.color = "#143F6B"; //изменяем цвет бэкграунда кнопки
   tg.MainButton.setParams({"color": "#143F6B"}); //так изменяются все параметры
   tg.MainButton.hide() //скрываем кнопку

      Telegram.WebApp.onEvent('mainButtonClicked', function(){

         tg.sendData('some string that we need to send');
         //при клике на основную кнопку отправляем данные в строковом виде
      });


</script>
</html>